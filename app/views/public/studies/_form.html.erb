<%= form_with model: @study, url: @study.persisted? ? study_path(@study) : studies_path, method: @study.persisted? ? :patch : :post, local: true do |f| %>
  <table class="table">
    <tr>
      <%= f.file_field :image, class: "d-none", onchange: "previewImage(this);" %>
      <td class="form-group">
        <% if study.image.attached? %>
          <%= image_tag study.image, class: "open-file-field img-fluid study-image", id: "preview" %>
        <% else %>
          <%= image_tag "study_no_image.jpg", class: "open-file-field img-fluid study-image", id: "preview" %>
        <% end %>
      </td>
      <td class="form-group">
        <%= f.text_field :title, value: @study_copy&.title || @study.title, placeholder: "教材名", class: "form-control" %>
      </td>
    </tr>
    <tr>
      <td class="form-group">
        <%= f.label :status, "ステータス" %>
      </td>
      <td class="form-group text-right">
        <%= f.select :status, Study.statuses, include_blank: false, class: "form-control" %>
      </td>
    </tr>
    <tr>
      <td class="form-group">
        <%= f.label :tag_id, "カテゴリー", class: "pt-3" %>
      </td>
      <td>
        <div class="text-right" style="display: flex; justify-content: flex-end; flex-wrap: wrap;">
          <% Tag.all.each do |tag| %>
            <div class="ml-1">
              <%= f.check_box :tag_ids, { multiple: true }, tag.id, nil %> <%= tag.name %>
            </div>
          <% end %>
        </div>
      </td>
    </tr>
    <tr>
      <td colspan=2 class="form-group text-center">
        <%= f.submit '保存', class: "btn btn-dark" %>
      </td>
    </tr>
  </table>
<% end %>


<script>
  $(".open-file-field").on("click", () => {
    $("#study_image").click();
    return false;
  });

  function previewImage(obj)
  {
  	var fileReader = new FileReader();
  	fileReader.onload = (function() {
  		document.getElementById('preview').src = fileReader.result;
  	});
  	fileReader.readAsDataURL(obj.files[0]);
  }
</script>